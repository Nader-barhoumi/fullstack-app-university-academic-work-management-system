<div class="container mx-auto p-6 bg-gray-50 min-h-screen">
  <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">University Profile</h1>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center text-gray-600">
    <p>Loading institution data...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !loading" class="mb-6 p-4 bg-red-100 text-red-700 rounded-md text-center">
    {{ errorMessage }}
  </div>

  <!-- Profile View -->
  <div *ngIf="institution && !isEditing && !loading" class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
    <div class="flex flex-col md:flex-row items-center mb-6">
      <img *ngIf="institution.logo_url" [src]="institution.logo_url" alt="University Logo" class="w-32 h-32 object-contain mr-6 mb-4 md:mb-0">
      <div>
        <h2 class="text-3xl font-semibold text-gray-700">{{ institution.university }}</h2>
        <p class="text-lg text-gray-600">{{ institution.name }}</p>
      </div>
    </div>
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <p class="text-gray-700"><strong>Director:</strong> {{ institution.director }}</p>
        <p class="text-gray-700"><strong>Email:</strong> <a [href]="'mailto:' + institution.email" class="text-blue-600 hover:underline">{{ institution.email }}</a></p>
        <p class="text-gray-700"><strong>Phone:</strong> {{ institution.phone }}</p>
        <p class="text-gray-700"><strong>Fax:</strong> {{ institution.fax || 'N/A' }}</p>
      </div>
      <div>
        <p class="text-gray-700"><strong>Address:</strong></p>
        <p class="text-gray-600">{{ institution.address.address_details }}</p>
        <p class="text-gray-600">{{ institution.address.city || '' }} {{ institution.address.state }} {{ institution.address.zip_code }}</p>
        <p *ngIf="institution.address.additional_details" class="text-gray-600">{{ institution.address.additional_details }}</p>
      </div>
    </div>
    <button
      (click)="startEditing()"
      class="mt-6 w-full md:w-auto bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition duration-200"
    >
      Edit Profile
    </button>
  </div>

  <!-- Edit Form -->
  <div *ngIf="isEditing && editInstitution" class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
    <h2 class="text-2xl font-semibold text-gray-700 mb-6">Edit University Profile</h2>
    <form #institutionForm="ngForm" (ngSubmit)="updateInstitution(institutionForm)" class="space-y-4">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-600">Institution Name</label>
          <input
            id="name"
            [(ngModel)]="editInstitution.name"
            name="name"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['name'].invalid && institutionForm.controls['name'].touched}"
          >
          <div *ngIf="institutionForm.controls['name'].invalid && institutionForm.controls['name'].touched" class="text-red-500 text-sm mt-1">
            Institution name is required.
          </div>
        </div>
        <div>
          <label for="university" class="block text-sm font-medium text-gray-600">University</label>
          <input
            id="university"
            [(ngModel)]="editInstitution.university"
            name="university"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['university'].invalid && institutionForm.controls['university'].touched}"
          >
          <div *ngIf="institutionForm.controls['university'].invalid && institutionForm.controls['university'].touched" class="text-red-500 text-sm mt-1">
            University name is required.
          </div>
        </div>
        <div>
          <label for="director" class="block text-sm font-medium text-gray-600">Director</label>
          <input
            id="director"
            [(ngModel)]="editInstitution.director"
            name="director"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['director'].invalid && institutionForm.controls['director'].touched}"
          >
          <div *ngIf="institutionForm.controls['director'].invalid && institutionForm.controls['director'].touched" class="text-red-500 text-sm mt-1">
            Director name is required.
          </div>
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-600">Email</label>
          <input
            id="email"
            [(ngModel)]="editInstitution.email"
            name="email"
            required
            type="email"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['email'].invalid && institutionForm.controls['email'].touched}"
          >
          <div *ngIf="institutionForm.controls['email'].invalid && institutionForm.controls['email'].touched" class="text-red-500 text-sm mt-1">
            Valid email is required.
          </div>
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-600">Phone</label>
          <input
            id="phone"
            [(ngModel)]="editInstitution.phone"
            name="phone"
            required
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['phone'].invalid && institutionForm.controls['phone'].touched}"
          >
          <div *ngIf="institutionForm.controls['phone'].invalid && institutionForm.controls['phone'].touched" class="text-red-500 text-sm mt-1">
            Phone number is required.
          </div>
        </div>
        <div>
          <label for="fax" class="block text-sm font-medium text-gray-600">Fax</label>
          <input
            id="fax"
            [(ngModel)]="editInstitution.fax"
            name="fax"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        <div>
          <label for="address_id" class="block text-sm font-medium text-gray-600">Address ID</label>
          <input
            id="address_id"
            [(ngModel)]="editInstitution.address_id"
            name="address_id"
            required
            type="number"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
            [ngClass]="{'border-red-500': institutionForm.controls['address_id'].invalid && institutionForm.controls['address_id'].touched}"
          >
          <div *ngIf="institutionForm.controls['address_id'].invalid && institutionForm.controls['address_id'].touched" class="text-red-500 text-sm mt-1">
            Valid address ID is required.
          </div>
        </div>
        <div>
          <label for="logo_url" class="block text-sm font-medium text-gray-600">Logo URL</label>
          <input
            id="logo_url"
            [(ngModel)]="editInstitution.logo_url"
            name="logo_url"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
      </div>
      <div class="flex space-x-4">
        <button
          type="submit"
          [disabled]="!institutionForm.valid"
          class="w-full md:w-auto bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400 transition duration-200"
        >
          Save Changes
        </button>
        <button
          type="button"
          (click)="cancelEditing()"
          class="w-full md:w-auto bg-gray-600 text-white p-2 rounded-md hover:bg-gray-700 transition duration-200"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
